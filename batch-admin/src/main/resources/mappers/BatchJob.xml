<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "mybatis-3-mapper.dtd">

<mapper namespace="BatchJobMapper">
    <select id="SELECT_JOB_INSTANCES" parameterType="kr.seok.admin.dto.JobInstanceRequest" resultType="kr.seok.admin.domain.BatchJobInstance">
        SELECT
            JOB_INSTANCE_ID AS jobInstanceId
            , JOB_NAME AS jobName
            , VERSION AS version
            , JOB_KEY AS jobKey
        FROM BATCH_JOB_INSTANCE
        WHERE 1=1
        AND JOB_NAME = #{jobName}
        ORDER BY JOB_INSTANCE_ID DESC
    </select>

    <select id="SELECT_JOB_EXECUTIONS" parameterType="kr.seok.admin.dto.JobExecutionRequest" resultType="kr.seok.admin.domain.BatchJobExecution">
        SELECT
            B.JOB_INSTANCE_ID AS jobInstanceId
            , B.JOB_NAME AS jobName
            , A.JOB_EXECUTION_ID AS jobExecutionId
            , A.VERSION AS version
            , A.CREATE_TIME AS createTime
            , A.START_TIME AS startTime
            , A.END_TIME AS endTime
            , A.LAST_UPDATED AS lastUpdated
            , A.STATUS AS status
            , A.EXIT_CODE AS exitCode
            , A.EXIT_MESSAGE AS exitMessage
        FROM BATCH_JOB_EXECUTION A
        JOIN BATCH_JOB_INSTANCE B
        ON A.JOB_INSTANCE_ID = B.JOB_INSTANCE_ID
        WHERE 1=1
        AND B.JOB_NAME = #{jobName}
        AND B.JOB_INSTANCE_ID = #{jobInstanceId}
    </select>

    <select id="SELECT_JOB_EXECUTIONS_PARAMS" parameterType="kr.seok.admin.dto.JobExecutionParamsRequest" resultType="kr.seok.admin.domain.BatchJobExecutionParams">
        SELECT
        B.JOB_INSTANCE_ID
        , B.JOB_NAME
        , A.JOB_EXECUTION_ID
        , A.VERSION
        , A.CREATE_TIME
        , A.START_TIME
        , A.END_TIME
        , A.LAST_UPDATED
        , A.STATUS
        , A.EXIT_CODE
        , A.EXIT_MESSAGE
        FROM BATCH_JOB_EXECUTION A
        JOIN BATCH_JOB_INSTANCE B
        ON A.JOB_INSTANCE_ID = B.JOB_INSTANCE_ID
        WHERE 1=1
        AND B.JOB_NAME = #{jobName}
        AND B.JOB_INSTANCE_ID = #{jobInstanceId}
    </select>

</mapper>
